{% extends "airflow/main.html" %}
{% import "vendors/_macros.html" as _macros -%}

{% block content %}
<div class="page-header">
  <h1>Interface: {{ interface.display_name }}</h1>
</div>

<ul class="nav nav-tabs">
  <li role="presentation"><a href="{{ url_for('VendorManagementView.dashboard') }}">Dashboard</a></li>
  <li role="presentation" class="active"><a href="{{ url_for('VendorManagementView.vendors') }}">Vendors</a></li>
</ul>

<ol class="breadcrumb">
  <li><a href="{{ url_for('VendorManagementView.vendors') }}">All</a></li>
  <li><a href="{{ url_for('VendorManagementView.vendor', vendor_id=interface.vendor.id) }}">{{ interface.vendor.display_name }}</a></li>
  <li class="active">{{ interface.display_name }}</li>
</ol>

<dl class="dl-horizontal">
  <dt>Vendor</dt>
  <dd><a href="{{ url_for('VendorManagementView.vendor', vendor_id=interface.vendor.id) }}">{{ interface.vendor.display_name }}</a></dd>
  <dt>Interface ID</dt>
  <dd>{{ interface.folio_interface_uuid or 'Upload only' }}</dd>
  <dt>Import Profile</dt>
  {% if interface.folio_data_import_profile_uuid %}
    <dd>{{ interface.folio_data_import_processing_name }} ({{ interface.folio_data_import_profile_uuid }})</dd>
  {% else %}
    <dd>Skip import</dd>
  {% endif %}
  <dt>File Pattern</dt>
  <dd>{{ interface.file_pattern }}</dd>
  <dt>Remote Path</dt>
  <dd>{{ interface.remote_path }}</dd>
  <dt>Delay (Days)</dt>
  <dd>{{ interface.processing_delay_in_days }}</dd>
  <dt>Active</dt>
  <dd>{{ interface.active }}</dd>
</dl>

<a href="{{ url_for("VendorManagementView.interface_edit", interface_id=interface.id) }}">
  <button class="btn btn-default">Edit</button>
</a>

<h3>File upload</h3>
<form enctype="multipart/form-data" method="POST" action="{{ url_for('VendorManagementView.file_upload', interface_id=interface.id) }}">
  <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
  <div class="form-group">
      <p class="help-block">
          Upload and process a file for this interface.
      </p>
      <input type="file" id="file-upload" name="file-upload">

  </div>
  <input type="submit" class="btn btn-default" value="Upload">
</form>


<h2>Pending Loads</h2>

<table id="pending-files" class="table table-striped table-condensed">
  <thead>
    <td>ID</td>
    <td>Created</td>
    <td>Updated</td>
    <td>Filename</td>
    <td>File Size</td>
    <td>File Timestamp</td>
    <td>Expected Load</td>
    <td>Status</td>
  </thead>
  {% for file in interface.pending_files %}
  <tr>
    <td><a href="{{ url_for('VendorManagementView.file', file_id=file.id) }}">{{ file.id }}</a></td>
    <td>{{ file.created }}</td>
    <td>{{ file.updated }}</td>
    <td>{{ file.vendor_filename }} {{ _macros.fileDownload(file) }}</td>
    <td>{{ file.filesize }}</td>
    <td>{{ file.vendor_timestamp }}</td>
    <td>{{ file.expected_load_time }}</td>
    <td>{{ file.status.value}}</td>
  </tr>
  {% endfor %}
</table>

<h2>Completed Loads</h2>

<table id="loaded-files" class="table table-striped table-condensed">
  <thead>
    <td>ID</td>
    <td>Created</td>
    <td>Updated</td>
    <td>Filename</td>
    <td>File Size</td>
    <td>File Timestamp</td>
    <td>Loaded</td>
    <td>Actions</td>
  </thead>
  {% for file in interface.processed_files %}
  <tr>
    <td><a href="{{ url_for('VendorManagementView.file', file_id=file.id) }}">{{ file.id }}</a></td>
    <td>{{ file.created }}</td>
    <td>{{ file.updated }}</td>
    <td>{{ file.vendor_filename }} {{ _macros.fileDownload(file) }}</td>
    <td>{{ file.filesize }}</td>
    <td>{{ file.vendor_timestamp }}</td>
    <td>{{ file.loaded_timestamp }}</td>
    <td>
      <form action="{{ url_for('VendorManagementView.load_file', file_id=file.id, redirect_url=request.url) }}" method="POST">
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
        <input class="btn btn-link" type="submit" value="Reload" style="padding: 0px;">
      </form>
    </td>
  </tr>
  {% endfor %}
</table>

{% endblock %}
